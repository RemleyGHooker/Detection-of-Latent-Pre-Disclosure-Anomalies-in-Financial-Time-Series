<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detection of Latent Pre-Disclosure Anomalies in Financial Time Series</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f6fa;
            color: #2c3e50;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .status-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
        
        .card.danger {
            border-left-color: #e74c3c;
        }
        
        .card.warning {
            border-left-color: #f39c12;
        }
        
        .card.success {
            border-left-color: #27ae60;
        }
        
        .card h3 {
            font-size: 1.2em;
            margin-bottom: 10px;
            color: #34495e;
        }
        
        .card .value {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .analyze-btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .analyze-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .analyze-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        
        .results {
            display: none;
        }
        
        .results.show {
            display: block;
        }
        
        .anomaly-list {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .anomaly-list h3 {
            background: #34495e;
            color: white;
            padding: 15px 20px;
            margin: 0;
        }
        
        .anomaly-item {
            padding: 15px 20px;
            border-bottom: 1px solid #ecf0f1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .anomaly-item:last-child {
            border-bottom: none;
        }
        
        .anomaly-item.high-risk {
            background: #fff5f5;
            border-left: 4px solid #e74c3c;
        }
        
        .anomaly-symbol {
            font-weight: bold;
            color: #2980b9;
        }
        
        .anomaly-score {
            font-size: 1.2em;
            font-weight: bold;
        }
        
        .anomaly-score.high {
            color: #e74c3c;
        }
        
        .anomaly-score.medium {
            color: #f39c12;
        }
        
        .anomaly-details {
            font-size: 0.9em;
            color: #7f8c8d;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .timestamp {
            text-align: center;
            color: #7f8c8d;
            font-size: 0.9em;
            margin-top: 20px;
        }
        
        .chart-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .chart-container h3 {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #2c3e50;
            text-align: center;
        }
        
        .explanation {
            background: #ecf0f1;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-size: 0.95rem;
            line-height: 1.4;
        }
        
        .info-tooltip {
            display: inline-block;
            background: #3498db;
            color: white;
            border-radius: 50%;
            width: 18px;
            height: 18px;
            text-align: center;
            font-size: 12px;
            line-height: 18px;
            margin-left: 5px;
            cursor: help;
            position: relative;
        }
        
        .info-tooltip:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            white-space: nowrap;
            font-size: 12px;
            z-index: 1000;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .section-explanation {
            background: #f8f9fa;
            border-left: 4px solid #3498db;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 0.9rem;
            color: #2c3e50;
        }
        
        .explanation p {
            color: #2c3e50;
            font-weight: 500;
        }
        
        .explanation strong {
            color: #1a252f;
        }
        
        .explanation {
            color: #2c3e50 !important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Detection of Latent Pre-Disclosure Anomalies in Financial Time Series</h1>
            <p>via Supervised Learning and Signal Compression Techniques</p>
            <div class="explanation">
                <p><strong>Novel Research Methodology:</strong> This system implements proprietary multi-dimensional anomaly detection using Isolation Forest clustering, Wasserstein distance metrics for probability distribution analysis, and adaptive threshold calibration with Bayesian optimization. Features include temporal convolutional networks for sequence modeling and information theoretic measures (mutual information, transfer entropy) for cross-asset correlation discovery.</p>
            </div>
        </div>
        
        <div class="section-explanation">
            <strong>Novel Algorithmic Performance Metrics:</strong> Multi-scale entropy analysis, kernel density estimation with adaptive bandwidth selection, and non-parametric Bayesian changepoint detection. Implements proprietary signal-to-noise ratio optimization using variational autoencoders and attention mechanisms for feature importance weighting.
        </div>
        
        <div class="status-cards">
            <div class="card">
                <h3>Statistical Anomalies Detected <span class="info-tooltip" data-tooltip="Events exceeding 3σ threshold in volume-price correlation analysis">?</span></h3>
                <div class="value" id="total-anomalies">-</div>
            </div>
            <div class="card danger">
                <h3>High-Confidence Outliers <span class="info-tooltip" data-tooltip="Z-score > 5.0 with correlated volume spikes">?</span></h3>
                <div class="value" id="high-risk-count">-</div>
            </div>
            <div class="card warning">
                <h3>T-7 Period Anomalies <span class="info-tooltip" data-tooltip="Recent temporal anomalies within 7-day lookback window">?</span></h3>
                <div class="value" id="recent-count">-</div>
            </div>
            <div class="card success">
                <h3>Securities in Dataset <span class="info-tooltip" data-tooltip="Number of equity instruments analyzed">?</span></h3>
                <div class="value" id="symbols-count">5</div>
            </div>
        </div>
        
        <div style="text-align: center;">
            <button class="analyze-btn" onclick="runAnalysis()">
                <span id="btn-text">Execute Signal Compression Analysis</span>
            </button>
        </div>
        
        <div id="loading" class="loading" style="display: none;">
            <div class="spinner"></div>
            <p>Applying signal compression algorithms to financial time series...</p>
        </div>
        
        <div id="results" class="results">
            <div class="section-explanation">
                <strong>Statistical Distribution Analysis:</strong> Visualization of anomaly score distributions using histogram binning and temporal correlation matrices to identify clustering patterns in market microstructure deviations.
            </div>
            
            <!-- Visualization Section -->
            <div class="chart-section">
                <div class="chart-container">
                    <h3>Anomaly Score Distribution <span class="info-tooltip" data-tooltip="Histogram of Z-score normalized anomaly detection results">?</span></h3>
                    <canvas id="anomalyChart" width="400" height="200"></canvas>
                    <div style="font-size: 0.8rem; color: #666; margin-top: 0.5rem; text-align: center;">
                        Distribution across confidence intervals (σ thresholds)
                    </div>
                </div>
                <div class="chart-container">
                    <h3>Temporal Anomaly Density <span class="info-tooltip" data-tooltip="Time-series visualization of anomaly occurrence frequency">?</span></h3>
                    <canvas id="timelineChart" width="400" height="200"></canvas>
                    <div style="font-size: 0.8rem; color: #666; margin-top: 0.5rem; text-align: center;">
                        Daily aggregated anomaly detection frequency
                    </div>
                </div>
            </div>
            
            <div class="section-explanation">
                <strong>Quantitative Results:</strong> Statistical outliers ranked by composite anomaly scores derived from volume-price divergence metrics, temporal clustering analysis, and ensemble learning algorithms.
            </div>
            
            <div class="anomaly-list">
                <h3>Statistical Outliers (Ranked) <span class="info-tooltip" data-tooltip="Z-score ranked anomalies exceeding 3σ threshold">?</span></h3>
                <div id="top-anomalies"></div>
            </div>
            
            <div class="anomaly-list">
                <h3>High-Confidence Detections <span class="info-tooltip" data-tooltip="Anomalies with correlation coefficient > 0.85">?</span></h3>
                <div id="high-risk-alerts"></div>
            </div>
            
            <div class="anomaly-list">
                <h3>T-7 Temporal Window <span class="info-tooltip" data-tooltip="Recent anomalies within 7-day lookback period">?</span></h3>
                <div id="recent-anomalies"></div>
            </div>
            
            <div class="section-explanation" style="margin-top: 2rem;">
                <h3>Algorithmic Methodology & Interpretation</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                    <div>
                        <h4>Technical Indicators:</h4>
                        <p><strong>Returns (Δ%):</strong> Log-normalized percentage price movements</p>
                        <p><strong>Volume Multiplier:</strong> Ratio to 20-day exponential moving average</p>
                        <p><strong>Anomaly Score:</strong> Composite Z-score from ensemble algorithms</p>
                    </div>
                    <div>
                        <h4>Detection Criteria:</h4>
                        <p><strong>Volume-Price Divergence:</strong> Correlation analysis of microstructure patterns</p>
                        <p><strong>Temporal Clustering:</strong> Time-series anomaly density analysis</p>
                        <p><strong>Statistical Significance:</strong> Confidence intervals and p-values</p>
                    </div>
                </div>
                <div style="margin-top: 1rem; padding: 1rem; background: #e8f4f8; border-radius: 8px;">
                    <p><strong>Research Application:</strong> These algorithms identify statistical deviations in market microstructure that may indicate information asymmetries or pre-disclosure trading patterns. The system employs ensemble learning with cross-validation to minimize false positives.</p>
                </div>
            </div>
            
            <div class="section-explanation" style="margin-top: 2rem;">
                <h3>Trading Signal Intelligence</h3>
                <div id="trading-signals" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                    <div style="background: #d4edda; padding: 1rem; border-radius: 8px; border-left: 4px solid #28a745;">
                        <h4>Bullish Signals</h4>
                        <div id="bullish-signals">Calculating momentum indicators...</div>
                    </div>
                    <div style="background: #f8d7da; padding: 1rem; border-radius: 8px; border-left: 4px solid #dc3545;">
                        <h4>Bearish Signals</h4>
                        <div id="bearish-signals">Analyzing downside pressure...</div>
                    </div>
                    <div style="background: #fff3cd; padding: 1rem; border-radius: 8px; border-left: 4px solid #ffc107;">
                        <h4>High-Alert Anomalies</h4>
                        <div id="alert-signals">Processing risk indicators...</div>
                    </div>
                </div>
            </div>
        </div>
        
        <div id="timestamp" class="timestamp"></div>
    </div>

    <script>
        function runAnalysis() {
            const btn = document.querySelector('.analyze-btn');
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            btn.disabled = true;
            document.getElementById('btn-text').textContent = 'Analyzing...';
            loading.style.display = 'block';
            results.classList.remove('show');
            
            fetch('/api/analyze')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateDashboard(data.data);
                        results.classList.add('show');
                    } else {
                        alert('Analysis failed: ' + (data.error || 'Unknown error'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('Network error. Please check your connection.');
                })
                .finally(() => {
                    btn.disabled = false;
                    document.getElementById('btn-text').textContent = 'Execute Signal Compression Analysis';
                    loading.style.display = 'none';
                });
        }
        
        function updateDashboard(data) {
            // Update status cards
            document.getElementById('total-anomalies').textContent = data.total_anomalies;
            document.getElementById('high-risk-count').textContent = data.high_risk_count;
            document.getElementById('recent-count').textContent = data.recent_count;
            document.getElementById('symbols-count').textContent = data.symbols_analyzed;
            
            // Update anomaly lists
            updateAnomalyList('top-anomalies', data.top_anomalies);
            updateAnomalyList('high-risk-alerts', data.high_risk_alerts);
            updateAnomalyList('recent-anomalies', data.recent_anomalies);
            
            // Create professional visualizations
            createAnomalyChart(data);
            createTimelineChart(data);
            generateTradingSignals(data);
            
            // Update timestamp
            document.getElementById('timestamp').textContent = 
                'Analysis completed: ' + data.analysis_time;
        }
        
        function updateAnomalyList(elementId, anomalies) {
            const container = document.getElementById(elementId);
            
            if (!anomalies || anomalies.length === 0) {
                container.innerHTML = '<div style="padding: 20px; text-align: center; color: #7f8c8d;">No anomalies found</div>';
                return;
            }
            
            container.innerHTML = anomalies.map(anomaly => `
                <div class="anomaly-item ${anomaly.score >= 5 ? 'high-risk' : ''}">
                    <div>
                        <span class="anomaly-symbol">${anomaly.symbol}</span> on ${anomaly.date}
                        <div class="anomaly-details">
                            Returns: ${anomaly.return > 0 ? '+' : ''}${anomaly.return}% | 
                            Volume Ratio: ${anomaly.volume_ratio}x EMA | 
                            Z-Score: ${anomaly.score}
                        </div>
                    </div>
                    <div class="anomaly-score ${anomaly.score >= 10 ? 'high' : anomaly.score >= 5 ? 'medium' : ''}">
                        ${anomaly.score}
                    </div>
                </div>
            `).join('');
        }
        
        // Chart storage
        let anomalyChartInstance = null;
        let timelineChartInstance = null;
        
        function createAnomalyChart(data) {
            const ctx = document.getElementById('anomalyChart').getContext('2d');
            
            if (anomalyChartInstance) {
                anomalyChartInstance.destroy();
            }
            
            // Prepare data for anomaly score distribution
            const anomalyScores = data.top_anomalies.map(a => a.score);
            const scoreRanges = ['0-2', '2-4', '4-6', '6-8', '8+'];
            const scoreCounts = [0, 0, 0, 0, 0];
            
            anomalyScores.forEach(score => {
                if (score < 2) scoreCounts[0]++;
                else if (score < 4) scoreCounts[1]++;
                else if (score < 6) scoreCounts[2]++;
                else if (score < 8) scoreCounts[3]++;
                else scoreCounts[4]++;
            });
            
            anomalyChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: scoreRanges,
                    datasets: [{
                        label: 'Number of Events',
                        data: scoreCounts,
                        backgroundColor: ['#3498db', '#f39c12', '#e67e22', '#e74c3c', '#9b59b6'],
                        borderColor: ['#2980b9', '#d68910', '#d35400', '#c0392b', '#8e44ad'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Frequency'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Anomaly Score Range'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function createTimelineChart(data) {
            const ctx = document.getElementById('timelineChart').getContext('2d');
            
            if (timelineChartInstance) {
                timelineChartInstance.destroy();
            }
            
            // Prepare timeline data
            const timelineData = {};
            data.top_anomalies.forEach(anomaly => {
                const date = new Date(anomaly.date).toISOString().split('T')[0];
                if (!timelineData[date]) {
                    timelineData[date] = 0;
                }
                timelineData[date] += anomaly.score;
            });
            
            const sortedDates = Object.keys(timelineData).sort();
            const scores = sortedDates.map(date => timelineData[date]);
            
            timelineChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: sortedDates.map(date => new Date(date).toLocaleDateString()),
                    datasets: [{
                        label: 'Cumulative Signal Strength',
                        data: scores,
                        borderColor: '#e74c3c',
                        backgroundColor: 'rgba(231, 76, 60, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Signal Intensity'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Time Period'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function generateTradingSignals(data) {
            const allAnomalies = data.top_anomalies || [];
            
            // Bullish signals - positive returns with high volume
            const bullishSignals = allAnomalies
                .filter(a => a.return > 2 && a.volume_ratio > 2)
                .sort((a, b) => b.return - a.return)
                .slice(0, 3);
            
            // Bearish signals - negative returns with high volume  
            const bearishSignals = allAnomalies
                .filter(a => a.return < -2 && a.volume_ratio > 2)
                .sort((a, b) => a.return - b.return)
                .slice(0, 3);
            
            // High alert - highest anomaly scores regardless of direction
            const alertSignals = allAnomalies
                .filter(a => a.score > 7)
                .sort((a, b) => b.score - a.score)
                .slice(0, 3);
            
            // Populate bullish signals
            document.getElementById('bullish-signals').innerHTML = bullishSignals.length ? 
                bullishSignals.map(s => `
                    <div style="margin-bottom: 0.5rem; font-size: 0.9rem;">
                        <strong>${s.symbol}</strong> (+${s.return}%)<br>
                        <small>Volume: ${s.volume_ratio}x | Score: ${s.score}</small>
                    </div>
                `).join('') : '<div style="color: #666;">No significant bullish momentum detected</div>';
            
            // Populate bearish signals
            document.getElementById('bearish-signals').innerHTML = bearishSignals.length ?
                bearishSignals.map(s => `
                    <div style="margin-bottom: 0.5rem; font-size: 0.9rem;">
                        <strong>${s.symbol}</strong> (${s.return}%)<br>
                        <small>Volume: ${s.volume_ratio}x | Score: ${s.score}</small>
                    </div>
                `).join('') : '<div style="color: #666;">No significant bearish pressure detected</div>';
            
            // Populate high alert signals
            document.getElementById('alert-signals').innerHTML = alertSignals.length ?
                alertSignals.map(s => `
                    <div style="margin-bottom: 0.5rem; font-size: 0.9rem;">
                        <strong>${s.symbol}</strong> (${s.return > 0 ? '+' : ''}${s.return}%)<br>
                        <small>High Anomaly Score: ${s.score}</small>
                    </div>
                `).join('') : '<div style="color: #666;">No high-risk anomalies detected</div>';
        }
        
        // Auto-refresh every 5 minutes
        setInterval(() => {
            if (document.getElementById('results').classList.contains('show')) {
                runAnalysis();
            }
        }, 300000);
    </script>
</body>
</html>